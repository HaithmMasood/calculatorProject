<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>React Calculator</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --border: #1f2937;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #22d3ee;
        --danger: #ef4444;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: radial-gradient(1200px 800px at 10% 10%, #0b1022, var(--bg));
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      }
      .app {
        width: 320px;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
        overflow: hidden;
      }
      .display {
        padding: 20px 16px;
        text-align: right;
        font-variant-numeric: tabular-nums;
        background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
        border-bottom: 1px solid var(--border);
      }
      .display .expr {
        min-height: 20px;
        color: var(--muted);
        font-size: 12px;
        letter-spacing: .3px;
      }
      .display .value {
        margin-top: 6px;
        font-size: 32px;
        line-height: 1.2;
        word-break: break-all;
      }
      .keys {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
      }
      button {
        appearance: none;
        border: 0;
        margin: 0;
        padding: 16px 12px;
        font-size: 16px;
        color: var(--text);
        background: transparent;
        cursor: pointer;
        border-right: 1px solid var(--border);
        border-bottom: 1px solid var(--border);
        transition: transform .02s ease, background .15s ease, color .15s ease;
      }
      button:active { transform: translateY(1px) scale(0.995); }
      .key-op { color: var(--accent); }
      .key-ac { color: var(--danger); }
      .key-eq { background: linear-gradient(180deg, rgba(34,211,238,.18), rgba(34,211,238,.08)); }
      .span-2 { grid-column: span 2; }
      .footer { text-align: center; padding: 10px; font-size: 12px; color: var(--muted); }
      a { color: var(--accent); text-decoration: none; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <!-- React + ReactDOM UMD builds -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transform (dev only) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
      const { useState } = React;

      function formatNumber(n) {
        const s = String(n);
        // Limit to 12 significant digits to prevent overflow artifacts
        const num = Number(s);
        if (!Number.isFinite(num)) return 'Error';
        const out = Math.round(num * 1e12) / 1e12;
        return String(out);
      }

      function Calculator() {
        const [display, setDisplay] = useState('0');
        const [expression, setExpression] = useState('');
        const [first, setFirst] = useState(null);
        const [op, setOp] = useState(null);
        const [waiting, setWaiting] = useState(false);

        const ops = {
          '+': (a, b) => a + b,
          '-': (a, b) => a - b,
          '×': (a, b) => a * b,
          '÷': (a, b) => b === 0 ? NaN : a / b,
        };

        function inputDigit(d) {
          if (waiting) {
            setDisplay(String(d));
            setWaiting(false);
          } else {
            setDisplay(prev => (prev === '0' ? String(d) : prev + d));
          }
        }

        function inputDot() {
          setDisplay(prev => (prev.includes('.') ? prev : prev + '.'));
        }

        function clearAll() {
          setDisplay('0');
          setExpression('');
          setFirst(null);
          setOp(null);
          setWaiting(false);
        }

        function setOperator(nextOp) {
          const current = Number(display);
          if (first == null) {
            setFirst(current);
            setExpression(formatNumber(current) + ' ' + nextOp);
          } else if (!waiting) {
            const fn = ops[op];
            const result = fn ? fn(first, current) : current;
            setFirst(result);
            setDisplay(formatNumber(result));
            setExpression(formatNumber(result) + ' ' + nextOp);
          } else {
            setExpression(prev => prev.replace(/.$/, nextOp));
          }
          setOp(nextOp);
          setWaiting(true);
        }

        function equals() {
          if (op == null || waiting) return;
          const current = Number(display);
          const fn = ops[op];
          const result = fn ? fn(first, current) : current;
          setDisplay(formatNumber(result));
          setExpression('');
          setFirst(result);
          setOp(null);
          setWaiting(true);
        }

        function keyHandler(e) {
          const { key } = e;
          if (/^[0-9]$/.test(key)) inputDigit(Number(key));
          else if (key === '.') inputDot();
          else if (key === 'Escape') clearAll();
          else if (key === 'Enter' || key === '=') equals();
          else if (['+', '-', '*', '/'].includes(key)) {
            setOperator(key === '*' ? '×' : key === '/' ? '÷' : key);
          }
        }

        React.useEffect(() => {
          window.addEventListener('keydown', keyHandler);
          return () => window.removeEventListener('keydown', keyHandler);
        }, [first, op, waiting, display]);

        const Key = ({ label, className, onPress }) => (
          <button className={className} onClick={onPress}>{label}</button>
        );

        return (
          <div className="app">
            <div className="display">
              <div className="expr" aria-live="polite">{expression}</div>
              <div className="value" aria-live="polite">{display}</div>
            </div>
            <div className="keys" role="group" aria-label="Calculator keys">
              <Key label="AC" className="key-ac" onPress={clearAll} />
              <Key label="÷" className="key-op" onPress={() => setOperator('÷')} />
              <Key label="×" className="key-op" onPress={() => setOperator('×')} />
              <Key label="-" className="key-op" onPress={() => setOperator('-')} />

              <Key label="7" onPress={() => inputDigit(7)} />
              <Key label="8" onPress={() => inputDigit(8)} />
              <Key label="9" onPress={() => inputDigit(9)} />
              <Key label="+" className="key-op" onPress={() => setOperator('+')} />

              <Key label="4" onPress={() => inputDigit(4)} />
              <Key label="5" onPress={() => inputDigit(5)} />
              <Key label="6" onPress={() => inputDigit(6)} />
              <Key label="=" className="key-eq" onPress={equals} />

              <Key label="1" onPress={() => inputDigit(1)} />
              <Key label="2" onPress={() => inputDigit(2)} />
              <Key label="3" onPress={() => inputDigit(3)} />
              <Key label="." onPress={inputDot} />

              <Key label="0" className="span-2" onPress={() => inputDigit(0)} />
              <div></div>
              <div></div>
            </div>
            <div className="footer">React Calculator • Keyboard: 0-9 . + - * / Enter Esc</div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<Calculator />);
    </script>
  </body>
  </html>

